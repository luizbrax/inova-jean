<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz Fantasy - Desafio dos Drag√µes</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="dragon-bg"></div>

  <div class="container">
    <div class="header">
      <h1><i class="fas fa-dragon"></i> Quiz Fantasy</h1>
      <p>Desafie seu conhecimento e enfrente os drag√µes da sabedoria!</p>
    </div>

    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
      </div>
      <div class="progress-text">
        <span>0 acertos</span>
        <span id="score-display">0/12</span>
      </div>
    </div>

    <!-- Tela de in√≠cio -->
    <div id="start-screen" class="start-screen">
      <h2>Bem-vindo ao Quiz Fantasy!</h2>
      <p>Teste seus conhecimentos e enfrente os drag√µes da sabedoria.</p>
      <button class="btn" id="start-btn">Iniciar Quiz</button>
    </div>


    <div class="quiz-content hidden">
      <!-- Pergunta atual -->
      <div id="quiz-container">
        <div class="question-container">
          <div class="question-number">Pergunta <span id="current-question">1</span> de 12</div>
          <div class="question-text" id="question-text">Carregando pergunta...</div>
        </div>

        <div class="options-container" id="options-container">
          <!-- Op√ß√µes ser√£o inseridas aqui -->
        </div>

        <div class="controls">
          <button class="btn" id="next-btn" disabled>Pr√≥xima Pergunta</button>
        </div>
      </div>

      <!-- Resultado final -->
      <div id="result-container" class="result-container hidden">
        <div class="dragon-icon">
          <i class="fas fa-dragon"></i>
        </div>
        <h2 class="result-title">Desafio Conclu√≠do!</h2>
        <div class="score-display" id="final-score">0/12</div>
        <div class="message" id="result-message">Voc√™ enfrentou os drag√µes com bravura!</div>

        <!-- Se√ß√£o de recordes -->
        <div class="records-section">
          <h3 class="records-title">
            <i class="fas fa-trophy"></i> Seu Recorde Pessoal
          </h3>
          <div class="record-value" id="record-value">0/12</div>
          <div id="record-message" class="message"></div>
        </div>

        <button class="btn" id="restart-btn">Jogar Novamente</button>
      </div>
    </div>
  </div>

  <script>
    // Estado do quiz
    const state = {
      currentQuestion: 0,
      score: 0,
      questions: [],
      selectedOption: null,
      answered: false,
      bestScore: parseInt(localStorage.getItem('quizFantasyBestScore')) || 0
    };

    // Elementos DOM
    const quizContainer = document.getElementById('quiz-container');
    const resultContainer = document.getElementById('result-container');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const currentQuestionEl = document.getElementById('current-question');
    const nextBtn = document.getElementById('next-btn');
    const restartBtn = document.getElementById('restart-btn');
    const progressFill = document.getElementById('progress-fill');
    const scoreDisplay = document.getElementById('score-display');
    const finalScore = document.getElementById('final-score');
    const resultMessage = document.getElementById('result-message');
    const recordValue = document.getElementById('record-value');
    const recordMessage = document.getElementById('record-message');

    // Fun√ß√£o para decodificar HTML entities
    function decodeHtml(html) {
      const txt = document.createElement('textarea');
      txt.innerHTML = html;
      return txt.value;
    }

    // Fun√ß√£o para embaralhar um array
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // Fun√ß√£o para traduzir texto do ingl√™s para portugu√™s
    async function translateToPT(text) {
      const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|pt`);
      const data = await response.json();
      return data.responseData.translatedText;
    }

    // Inicializa o quiz
    async function initQuiz() {
      try {
        // Busca perguntas da API em ingl√™s
        const response = await fetch('https://opentdb.com/api.php?amount=12&category=9&difficulty=easy&type=multiple');
        const data = await response.json();

        if (data.response_code === 0) {
          // Traduz todas as perguntas e respostas para portugu√™s
          state.questions = await Promise.all(data.results.map(async q => ({
            question: await translateToPT(decodeHtml(q.question)),
            correct_answer: await translateToPT(decodeHtml(q.correct_answer)),
            incorrect_answers: await Promise.all(q.incorrect_answers.map(a => translateToPT(decodeHtml(a))))
          })));

          shuffleArray(state.questions);
          loadQuestion();
        } else {
          throw new Error('N√£o foi poss√≠vel carregar as perguntas');
        }
      } catch (error) {
        console.error('Erro ao carregar perguntas:', error);
        questionText.textContent = 'Erro ao carregar perguntas. Por favor, recarregue a p√°gina.';
      }
    }

    // Carrega a pergunta atual
    function loadQuestion() {
      if (state.currentQuestion >= state.questions.length) {
        showResults();
        return;
      }

      const question = state.questions[state.currentQuestion];
      currentQuestionEl.textContent = state.currentQuestion + 1;
      questionText.innerHTML = question.question;

      const allAnswers = [...question.incorrect_answers, question.correct_answer];
      shuffleArray(allAnswers);

      optionsContainer.innerHTML = '';
      allAnswers.forEach((answer, index) => {
        const option = document.createElement('div');
        option.className = 'option';
        option.innerHTML = `
                    <span class="option-letter">${String.fromCharCode(65 + index)}</span>
                    ${answer}
                `;
        option.addEventListener('click', () => selectOption(option, answer, question.correct_answer));
        optionsContainer.appendChild(option);
      });

      state.selectedOption = null;
      state.answered = false;
      nextBtn.disabled = true;

      scoreDisplay.textContent = `${state.score}/${state.questions.length}`;
      updateProgressBar();
    }

    function selectOption(option, selectedAnswer, correctAnswer) {
      if (state.answered) return;
      state.selectedOption = option;
      state.answered = true;

      document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
      option.classList.add('selected');

      if (selectedAnswer === correctAnswer) {
        option.classList.add('correct');
        state.score++;
      } else {
        option.classList.add('incorrect');
        document.querySelectorAll('.option').forEach(opt => {
          if (opt.textContent.trim().includes(correctAnswer)) opt.classList.add('correct');
        });
      }

      nextBtn.disabled = false;
      updateProgressBar();
    }

    function nextQuestion() {
      state.currentQuestion++;
      loadQuestion();
    }

    function showResults() {
      quizContainer.classList.add('hidden');
      resultContainer.classList.remove('hidden');

      finalScore.textContent = `${state.score}/${state.questions.length}`;

      let isNewRecord = false;
      if (state.score > state.bestScore) {
        state.bestScore = state.score;
        localStorage.setItem('quizFantasyBestScore', state.bestScore);
        isNewRecord = true;
      }

      recordValue.textContent = `${state.bestScore}/${state.questions.length}`;
      if (isNewRecord) {
        recordValue.classList.add('new-record');
        recordMessage.textContent = 'üéâ NOVO RECORDE! Voc√™ superou sua melhor pontua√ß√£o!';
        recordMessage.style.color = '#ff00ff';
      } else if (state.score === state.bestScore && state.score > 0) {
        recordMessage.textContent = 'Voc√™ igualou seu recorde pessoal!';
        recordMessage.style.color = '#ffd700';
      } else {
        recordMessage.textContent = `Seu melhor recorde √© ${state.bestScore} acertos.`;
        recordMessage.style.color = '#aaa';
      }

      let message = '';
      if (state.score === 0) message = 'Os drag√µes riram da sua ignor√¢ncia! Estude mais!';
      else if (state.score <= 3) message = 'Voc√™ foi derrotado pelos drag√µes! Tente novamente!';
      else if (state.score <= 6) message = 'Voc√™ sobreviveu ao ataque dos drag√µes! Bom trabalho!';
      else if (state.score <= 9) message = 'Voc√™ domou os drag√µes menores! Quase perfeito!';
      else if (state.score <= 11) message = 'Voc√™ √© um verdadeiro domador de drag√µes! Incr√≠vel!';
      else message = 'Voc√™ √© o MESTRE DOS DRAG√ïES! Ningu√©m jamais teve tanta sabedoria!';

      resultMessage.textContent = message;
    }

    function updateProgressBar() {
      const percentage = (state.score / state.questions.length) * 100;
      progressFill.style.width = `${percentage}%`;
      if (state.score <= 3) progressFill.style.background = 'linear-gradient(to right, #ff0000, #ff4500)';
      else if (state.score <= 6) progressFill.style.background = 'linear-gradient(to right, #ff8c00, #ffd700)';
      else progressFill.style.background = 'linear-gradient(to right, #32cd32, #00ff00)';
    }

    // Event listeners
    nextBtn.addEventListener('click', nextQuestion);
    restartBtn.addEventListener('click', () => {
      state.currentQuestion = 0;
      state.score = 0;
      recordValue.classList.remove('new-record');
      resultContainer.classList.add('hidden');
      quizContainer.classList.remove('hidden');
      initQuiz();
    });

    const startScreen = document.getElementById('start-screen');
    const startBtn = document.getElementById('start-btn');

    startBtn.addEventListener('click', () => {
      startScreen.classList.add('hidden');
      document.querySelector('.quiz-content').classList.remove('hidden');
      initQuiz();
    });

    window.addEventListener('DOMContentLoaded', initQuiz);
  </script>
</body>

</html>